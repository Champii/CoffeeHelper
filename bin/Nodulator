#!/usr/bin/env coffee

#
# Nodulator Boostrap
#
# Usage: Nodulator init
#
fs = require 'fs'
path = require 'path'
exec = require('child_process').exec
async = require 'async'

args = process.argv[2..]

NodulatorRoot = path.resolve __dirname, '..'
appRoot = path.resolve '.'
console.log NodulatorRoot, appRoot

usage = ->
  console.error 'Usage: Nodulator init'

if args.length != 1 or args[0] != 'init'
  return usage()

async.series [
  (done) ->
    console.log 'Init base folder tree'
    exec 'cp -ra ' + (path.resolve NodulatorRoot, 'bin/baseFiles/') + '/* ' + appRoot, done

  (done) ->
    console.log 'Ok'
    console.log ''
    console.log 'Installation of Nodulator'
    exec 'npm install nodulator --save', done]

  , (err, results) ->
    return console.error err if err?

    console.log 'Ok'
    console.log ''
    console.log 'Done'
